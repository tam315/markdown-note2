# Domain Modeling Made Functional

## Introducing Domain-Driven Design

DDD の最終ゴールは、全ての関係者が同一のメンタルモデルを使って話をすること。
これにより、早く価値を届け、高い価値を生み、無駄をなくし、保守と拡張を容易にすることができる。

やるべきことは 4 つ。

- ビジネスイベントとワークフローに着目する。データ構造ではなく。
- ドメインをサブドメインに分割する
- サブドメインのなかでモデルをつくる
- 共通言語を作って使う

### ビジネスイベントを通じてドメインを理解する

ビジネスは、ある一時点のデータだけでは表現できないし価値も持たない。

ビジネスは、データを別のデータに**変換**していく
一連の**ワークフロー**により表現され、そこにこそ値があるといえる。

この変換を引き起こすきっかけを**ドメインイベント**と呼ぶ。
ドメインイベントは常に「〜が起こった」のような過去形で表現される。

例：

1. **イベント**: 「顧客が注文ボタンを押した」
2. **ワークフロー**:
   - 注文内容の検証
   - 在庫の確認と引き当て
   - 決済処理
   - 出荷指示の作成
3. **データ変換**:
   - 注文状態: 「カート」→「確定済み」
   - 在庫数: 減少
   - 顧客情報: 購入履歴に追加

ドメインイベントの発見にはイベントストーミングという手法が有効である。
イベントストーミングは以下を目的とする。

- 関係者全員で共有できるモデルを作る
- 関係者全員に当事者意識を持たせる
- 仕様の齟齬を見つける
- 部署間の接続がどうなっているか見つけ出す
- 帳票の必要性を明らかにする (=> 過去の出来事を知る必要性)

イベントを洗い出すときには、少ない範囲で満足せず、
可能な限り端まで拡張して見つけ出すことを心がける。

イベントを引き起こす要因を**コマンド**と呼ぶ。
コマンドは常に命令形で表現される。
コマンドはワークフローを通じて別のイベントを引き起こす。

- Command: "Place an order" -> Place Order というワークフロー -> Event: "order placed"
- Command: "Send shipment" -> Send Shipment というワークフロー -> Event: "shipment sent"

全てのイベントがコマンドから発生するわけではなく、
スケジュールされたイベントや外部システムからの通知によるものもある。
